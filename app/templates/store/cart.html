{% extends "base.html" %}

{% block title %}Alo!Mana? | Carrinho{% endblock %}

{% block content %}
<section class="cart-page">
    <div class="title-container">
        <h1 class="h1-title">Carrinho</h1>
        <h2 class="h2-subtitle">Resumo</h2>
    </div>

    {% if cart_lines %}
        <div class="cart-layout">
            <div class="cart-items">
                {% for line in cart_lines %}
                    <article class="cart-item">
                        <a href="{{ url_for('store.product_detail_page', slug=line.product.slug) }}">
                            <img src="{{ url_for('static', filename='img/' ~ line.product.image_filename) }}" alt="{{ line.product.name }}">
                        </a>
                        <div class="cart-item-info">
                            <h3>{{ line.product.name }}</h3>
                            <p>{{ line.product.price_cents | brl }} unidade</p>
                            <form class="cart-quantity-form" action="{{ url_for('store.update_cart_item', item_id=line.product.id) }}" method="post">
                                <input type="hidden" name="next" value="{{ request.path }}">
                                <label for="qtd-{{ line.product.id }}">Quantidade</label>
                                <input id="qtd-{{ line.product.id }}" type="number" name="quantity" min="1" max="99" value="{{ line.quantity }}">
                                <button class="buy-button" type="submit">Atualizar</button>
                            </form>
                            <form class="remove-item-form" action="{{ url_for('store.remove_cart_item', item_id=line.product.id) }}" method="post">
                                <input type="hidden" name="next" value="{{ request.path }}">
                                <button class="link-button" type="submit">Remover item</button>
                            </form>
                        </div>
                        <strong class="cart-item-total">{{ line.line_total_cents | brl }}</strong>
                    </article>
                {% endfor %}
            </div>

            <aside class="cart-summary">
                <h3>Total parcial</h3>
                <p class="cart-summary-total">{{ subtotal_cents | brl }}</p>
                <p class="cart-summary-hint">No checkout o cupom de 100% sera aplicado automaticamente.</p>
                <a class="buy-button cart-checkout-btn" href="{{ url_for('store.checkout_page') }}">Ir para checkout</a>
            </aside>
        </div>
    {% else %}
        <p class="empty-state">Seu carrinho esta vazio. Escolha produtos para continuar.</p>
        <a class="buy-button" href="{{ url_for('store.products_page') }}">Ver produtos</a>
    {% endif %}
</section>
{% endblock %}
